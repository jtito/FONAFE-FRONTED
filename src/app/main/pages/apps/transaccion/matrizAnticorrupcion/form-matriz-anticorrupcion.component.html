<p-toast></p-toast>
<div style="height: 50px;" class="bg-light"></div>
<!--DIALOGO AGREGAR / REPLICAR-->
<p-dialog header="Control" [(visible)]="DisplayControl" [style]="{width: '40vw'}">

    <div class="container">


        <div class="form-group col-sm-12">
            <label for="float-input" class="mb-2">Cantidad</label>

            <select class="form-select" [(ngModel)]="SelectedCant">
                <option value="">Seleccione</option>
                <option *ngFor="let control of listaCantControl"
                    [value]="control.nombreParametro">{{ control.nombreParametro }}</option>
            </select>

        </div>
        <br>

        <div class="row">
            <div class="form-group col-sm-12 p-text-right">
                <button type="button" class="btn btn-primary" (click)="AgregarControl()" >
                    Agregar
                </button>


            </div>

        </div>


    </div>

</p-dialog>


<div class="bg-light pb-5">
    <div class="container matriz-amplitud pt-2 bg-white mb-5">
        <div class="container matriz-amplitud sombraCards espacioBody pb-5" *ngIf="!loading">
            <div class="row d-flex">
                <div style="width: 4%" class="mt-4">
                    <button pButton type="button"
                            icon="pi pi-arrow-left"
                            class="p-button-danger p-button-rounded"
                            [routerLink]="[matrizRiesgo == null ? '../':'../../']"
                    ></button>
                </div>
                <div style="width: 96%">
                    <h3 class="animated fadeIn fast mt-4" style="margin-bottom: -10px;" *ngIf="matrizRiesgo == null">
                        Crear Matriz de Riesgo Anticorrupción</h3>
                    <h3 class="animated fadeIn fast mt-4" style="margin-bottom: -10px;" *ngIf="matrizRiesgo != null && editar == true">Actualizar Matriz de Riesgo Anticorrupción</h3>
                    <h3 class="animated fadeIn fast mt-4" style="margin-bottom: -10px;" *ngIf="matrizRiesgo != null && editar == false">Ver Matriz de Riesgo Anticorrupción</h3>
                </div>
            </div>

            <hr>
            <br>
            <fieldset class="border p-2 animated fadeIn">
            <form id="formMatriz" [formGroup]="formularioMatrizRiesgo"
                  (ngSubmit)=" matrizRiesgo == null ? registrarMatrizRiesgo() : actualizarMatrizRiesgo()">

                    <!-- <legend class="w-auto" *ngIf="matrizRiesgo == null">&nbsp;Crear Matriz de Riesgos Anticorrupción&nbsp;</legend>
                    <legend class="w-auto" *ngIf="matrizRiesgo != null && editar == true">&nbsp;Actualizar Matriz de Riesgos Anticorrupción&nbsp;</legend>
                    <legend class="w-auto" *ngIf="matrizRiesgo != null && editar == false">&nbsp;Ver Matriz de Riesgos Anticorrupción&nbsp;</legend>
                    <br><br> -->
                    <div class="container matriz-amplitud">
                        <div class="row">

                            <div class="form-group col-md-4 mb-4">
                                <label for="inputCartera" class="mb-2">Cartera</label>
                                <select class="form-select" id="inputCartera" disabled
                                        formControlName="cartera" (change)="onChangeCartera($event)">
                                    <option value="" selected>Seleccione</option>
                                    <option *ngFor="let cartera of listaCarteras"
                                            [value]="cartera.idParametro">{{ cartera.nombreParametro  }}</option>
                                </select>
                            </div>

                            <div class="form-group col-md-4 mb-4">
                                <label for="inputEmpresa" class="mb-2">Empresa</label>
                                <select class="form-select " id="inputEmpresa" [attr.disabled]="notadmin ? '' : null" aria-label="Default select example"
                                        formControlName="empresa" (change)="onChangeEmpresa($event)">
                                    <option value="" selected>Seleccione</option>
                                    <option *ngFor="let empresa of listaEmpresas"
                                            [value]="empresa.idEmpresa">{{ empresa.nombreCortoEmpresa  }}</option>
                                </select>
                            </div>

                            <div class="form-group col-md-4 mb-4">
                                <label for="inputSede" class="mb-2">Sede</label>
                                <select class="form-select" id="inputSede" [attr.disabled]="notadmin ? '' : null" 
                                        formControlName="sede" (change)="onChangeSede($event)">
                                    <option value="" selected>Seleccione</option>
                                    <option *ngFor="let sede of listaSedes"
                                            [value]="sede.idSede">{{ sede.descripcionSede  }}</option>
                                </select>
                            </div>

                            <div class="form-group col-md-4 mb-4">
                                <label for="inputPeridoo" class="mb-2">Periodo</label>
                                <select class="form-select" id="inputPeridoo" [class.is-invalid]="periodoNoValido"
                                        (change)="onChangePeriodo($event)" formControlName="periodo" >
                                    <option value="" selected>Seleccione</option>
                                    <option *ngFor="let periodo of listaPeriodos"
                                            [value]="periodo.idPeriodo">{{ periodo.deAnioPeriodo  }}</option>
                                </select>
                                <label *ngIf="periodoNoValido" id="validation-nombre-error"
                                       class="error jquery-validation-error small form-text invalid-feedback">Seleccione
                                    el periodo</label>
                            </div>

                            <div class="form-group col-md-4 mb-4">
                                <label for="idTipoMatriz" class="mb-2">Matriz Nivel</label>
                                <select formControlName="idTipoMatriz" class="form-select" id="idTipoMatriz" [class.is-invalid]="idTipoMatrizNoValido"
                                        (change)="onChangeTipoMatriz($event)" [class.is-invalid]="IdTipoMatrizNoValido" disabled>
                                    <option value="" selected>Seleccione</option>
                                    <option selected *ngFor="let tipo of listaTiposMatriz"
                                            [value]="tipo.nombreParametro">{{ tipo.deValor1}}</option>
                                </select>
                                <label *ngIf="idTipoMatrizNoValido" id="validation-nombre-error"
                                       class="error jquery-validation-error small form-text invalid-feedback">Seleccione
                                    el tipo de Matriz</label>
                            </div>

                            <div class="form-group col-md-4 mb-4">
                                <label for="inputMatrizNivel" class="mb-2">Tipo Matriz</label>
                                <select formControlName="idMatrizNivel" class="form-select" disabled id="inputMatrizNivel" aria-label="Default select example"
                                        (change)="onChangeMatrizNivel($event)">
                                    <option value="" selected>Seleccione</option>
                                    <option *ngFor="let tipoMatriz of listaTiposMatrizRiesgo"
                                            [value]="tipoMatriz.idParametro">{{ tipoMatriz.nombreParametro }}</option>
                                </select>
                            </div>

                             <div *ngIf="matrizRiesgo != null && editar == true && matrizRiesgo.indicadorBaja == '0'"
                                 class="form-group col-md-4  mb-4">
                                <label for="idEstado" class="mb-2">Estado</label>
                                <select formControlName="idEstado" class="form-select" id="idEstado"
                                        >
                                    <option selected *ngFor="let estado of listaEstados"
                                            [value]="estado.nombreParametro">{{ estado.deValor1}}</option>
                                </select>
                            </div>

                            <div class="container card-body p-text-left">
                                <button type="button" label="Añadir" pButton pRipple icon="pi pi-eye"
                                        class="p-button-secondary p-mr-2" [disabled] = "matrizRiesgo != null && editar == false"
                                        (click)="agregarMatrizRiesgo()" pButton icon="pi pi-plus" *ngIf="idPerfil!=tipoPerfilAuditor && idPerfil!=tipoPerfilUsuario"></button>

                                <img src="assets/imagenes/btnxls.png"
                                        pTooltip="XLS" style="float: right; width: 3%; cursor: pointer;"
                                        tooltipPosition="bottom" *ngIf="matrizRiesgo != null && editar == true"
                                        class="btnxls" (click)="exportExcel()">
                            </div>

                            <!-- Tabla de matriz de riesgo-->


                        </div>
                        <br>
                    </div>

            </form>

            <div class="">
                <p-table class="static-table" [value]="matricesRiesgo" dataKey="ordenTabla" [columns]="cols"
                         styleClass="p-datatable-responsive-demo p-datatable-gridlines"
                         [scrollable]="true"
                         scrollDirection="both"
                         scrollHeight="500px"
                         editMode="row">


                    <ng-template pTemplate="header" let-columns>

                        <tr *ngIf="idTipoMatrizSelect==0">
                            <th  
                                class="text-center" colspan="13" style="width: 78rem;background: #D72F17;color: white;">
                                DATOS GENERALES DEL RIESGO
                            </th>

                            <th
                                class="text-center" colspan="4" style="width: 24rem;background: #D72F17;color: white;">
                                EVALUACIÓN DE RIESGO INHERENTE
                            </th>

                            <th
                                class="text-center" colspan="7" style="width: 42rem;background: #D72F17;color: white;">
                                CONTROL
                            </th>

                            <th
                                class="text-center" colspan="4" style="width: 24rem;background: #D72F17;color: white;">
                                EVALUACIÓN DE RIESGO RESIDUAL
                            </th>

                            <th
                                class="text-center" colspan="7" style="width: 42rem;background: #D72F17;color: white;">
                                DEBIDA DILIGENCIA
                            </th>


                            <th
                                class="text-center" colspan="13" style="width: 78rem;background: #D72F17;color: white;">
                                PLAN DE ACCION
                            </th>

                            <th
                                class="text-center" colspan="8" style="width: 48rem;background: #D72F17;color: white;">
                                EVALUACIÓN DE EFICACIA
                            </th>


                        </tr>


                        <tr *ngIf="idTipoMatrizSelect==1">
                            <th  
                            class="text-center" colspan="13" style="width: 78rem;background: #D72F17;color: white;">
                            DATOS GENERALES DEL RIESGO
                        </th>

                        <th
                            class="text-center" colspan="4" style="width: 24rem;background: #D72F17;color: white;">
                            EVALUACIÓN DE RIESGO INHERENTE
                        </th>

                        <th
                            class="text-center" colspan="7" style="width: 42rem;background: #D72F17;color: white;">
                            CONTROL
                        </th>

                        <th
                            class="text-center" colspan="4" style="width: 24rem;background: #D72F17;color: white;">
                            EVALUACIÓN DE RIESGO RESIDUAL
                        </th>

                        <th
                            class="text-center" colspan="7" style="width: 42rem;background: #D72F17;color: white;">
                            DEBIDA DILIGENCIA
                        </th>


                        <th
                            class="text-center" colspan="13" style="width: 78rem;background: #D72F17;color: white;">
                            PLAN DE ACCION
                        </th>

                        <th
                            class="text-center" colspan="8" style="width: 48rem;background: #D72F17;color: white;">
                            EVALUACIÓN DE EFICACIA
                        </th>



                        </tr>

                        <tr style="justify-content: space-around;align-items: flex-start;">
                            <th [attr.colspan]="col.colspan" pSortableColumn="{{col.ordenadmiento}}" *ngFor="let col of columns"
                                class="{{col.headerClass}}" >
                                {{col.header}}
                            </th>
                            <th class="text-center tdsmall" >
                                Acción
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData let-columns="columns"
                                 let-editing="editing" let-ri="rowIndex">
                        <tr [pEditableRow]="rowData" style="justify-content: space-around;align-items: flex-start;">
                            <td *ngFor="let col of columns" class="{{col.class}}" [attr.colspan]="col.colspan" pEditableColumn>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <!-- <input pInputText class="text-center" type="text" [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]">-->
                                        <!-- && col.field != 'nuPuntajeInherente' && col.field != 'nuPuntajeResidual' -->
                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field != 'ordenTabla' && col.field != 'idMatrizRiesgo' && col.field != 'idCodigoControl' &&  col.field != 'idGerencia' && col.field != 'idProceso' && col.field != 'idSubProceso' && col.field != 'idTipoDelito' && col.field != 'idDebidaDilig'  && col.field != 'indFinPlanAccion' && col.field != 'idEstadoPlanAccion' && col.field != 'inFicaz' && col.field != 'nuPuntaInhe' && col.field != 'dePuntaInhe' && col.field != 'nuPuntaRes' && col.field != 'deSeveridadRes'
                                        && col.field != 'idOrigenRiesgo' && col.field != 'idFrecuenciaRiesgo' && col.field != 'idTipoRiesgo' && col.field != 'nuPuntajeInherente' && col.field != 'nuPuntajeResidual' && col.field != 'fechaInicioPlanAccion' && col.field != 'fechaFinPlanAccion' && col.field != 'idRespEstrategia' && col.field != 'nuImpaInhe' && col.field != 'nuFrecuInhe' && col.field != 'feFinPlanAccion'
                                                   && col.field != 'idFrecuenciaControl' && col.field != 'idOportunidadControl' && col.field != 'deSeveridadInherente' && col.field != 'deSeveridadResidual' && col.field != 'codRiesgo'  && col.field != 'nuPuntaInhe'  && col.field != 'dePuntaInhe'  && col.field != 'nuImpaRes' && col.field != 'nuFrecuRes'
                                                   && col.field != 'idAutomatizacionControl' && col.field != 'nuProbabilidadInherente' && col.field != 'nuImpactoInherente' && col.field != 'nuProbabilidadResidual' && col.field != 'nuImpactoResidual' && col.field != 'fechaPrevista' && col.field != 'fechaVerificacion' && col.field != 'idEficaciaControl'
                                                   && col.field != 'deRiesgo' && col.field != 'deControl' && col.field != 'dePlanAccion'" 
                                               class="text-center" type="text" [(ngModel)]="rowData[col.field]" placeholder="{{col.placeholder}}"
                                               [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]">


                                        <textarea pInputTextarea [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null"  *ngIf="col.field == 'deRiesgo'" rows="2" cols="40" autoResize="autoResize"
                                        [(ngModel)]="rowData[col.field]" ></textarea>

                                        <textarea pInputTextarea [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null"  *ngIf="col.field == 'deControl'" rows="2" cols="40" autoResize="autoResize"
                                        [(ngModel)]="rowData[col.field]" ></textarea>

                                        <textarea pInputTextarea [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null"  *ngIf="col.field == 'dePlanAccion'" rows="2" cols="40" autoResize="autoResize"
                                        [(ngModel)]="rowData[col.field]" ></textarea>
                                        
                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null"  *ngIf="col.field == 'codRiesgo'" [(ngModel)]="rowData[col.field]" type="text" (keyup)="onchangecod($event,ri)" (keydown)="onchangecod($event,ri)">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null"  *ngIf="col.field == 'fechaInicioPlanAccion'" [(ngModel)]="rowData[col.field]" type="date">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null"  *ngIf="col.field == 'feFinPlanAccion'" [(ngModel)]="rowData[col.field]" type="date">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null"  *ngIf="col.field == 'fechaPrevista'" [(ngModel)]="rowData[col.field]" type="date">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null"  *ngIf="col.field == 'fechaVerificacion'" [(ngModel)]="rowData[col.field]" type="date">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'nuFrecuInhe'" [(ngModel)]="rowData[col.field]"  
                                               class="text-center" (keyup)="limit_number_frec_inhe($event,ri)" (keydown)="limit_number_frec_inhe($event,ri)" type="number" 
                                               [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]"
                                               min="1.00" max="4.00" step="0.01">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'nuImpaInhe'" [(ngModel)]="rowData[col.field]"
                                               class="text-center" (keyup)="limit_number_Impa_inhe($event,ri)" (keydown)="limit_number_Impa_inhe($event,ri)" type="number"
                                               [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]"
                                               min="1.00" max="4.00" step="0.01">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'nuPuntaInhe'" disabled
                                               class="text-center"
                                              type="number" [(ngModel)]="rowData[col.field]">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'nuFrecuRes'" [(ngModel)]="rowData[col.field]"
                                               class="text-center" (keyup)="limit_number_frec_res($event,ri)" (keydown)="limit_number_frec_res($event,ri)" type="number"
                                               [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]"
                                               min="1.00" max="4.00" step="0.01">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'nuImpaRes'" [(ngModel)]="rowData[col.field]"
                                               class="text-center" (keyup)="limit_number_Impa_res($event,ri)" (keydown)="limit_number_Impa_res($event,ri)" type="number"
                                               [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]"
                                               min="1.00" max="4.00" step="0.01">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'nuPuntaRes'" disabled
                                               class="text-center"
                                              type="number" [(ngModel)]="rowData[col.field]">

                                        <div *ngIf="col.field == 'dePuntaInhe'">


                                                <div *ngIf="rowData[col.field]=='Bajo'">
                                                    <div class="circle-green">{{rowData[col.field]}}</div>
                                                </div>

                                                <div *ngIf="rowData[col.field]=='Moderado'">
                                                    <div class="circle-yellow">{{rowData[col.field]}}</div>
                                                </div>

                                                <div *ngIf="rowData[col.field]=='Alto'">
                                                    <div class="circle-orange">{{rowData[col.field]}}</div>
                                                </div>

                                                <div *ngIf="rowData[col.field]=='Extremo'">
                                                    <div class="circle-red">{{rowData[col.field]}}</div>
                                                </div>

                                        </div>

                                        <div *ngIf="col.field == 'deSeveridadRes'">


                                            <div *ngIf="rowData[col.field]=='Bajo'">
                                                <div class="circle-green">{{rowData[col.field]}}</div>
                                            </div>

                                            <div *ngIf="rowData[col.field]=='Moderado'">
                                                <div class="circle-yellow">{{rowData[col.field]}}</div>
                                            </div>

                                            <div *ngIf="rowData[col.field]=='Alto'">
                                                <div class="circle-orange">{{rowData[col.field]}}</div>
                                            </div>

                                            <div *ngIf="rowData[col.field]=='Extremo'">
                                                <div class="circle-red">{{rowData[col.field]}}</div>
                                            </div>

                                    </div>

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'nuProbabilidadResidual'" (keyup)="limit_number_prob_control($event,ri)" (keydown)="limit_number_prob_control($event,ri)"
                                        class="text-center" type="text" [(ngModel)]="rowData[col.field]"
                                        [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]">

                                        <input pInputText [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'nuImpactoResidual'"  (keyup)="limit_number_impa_control($event,ri)" (keydown)="limit_number_impa_riesgo($event,ri)"
                                        class="text-center" type="text" [(ngModel)]="rowData[col.field]"
                                        [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]">
                                        <!--<p-dropdown  *ngIf="col.field == 'idGerencia'" [options]="this.listaGerencias"
                                                    [value]="rowData[col.field] == undefined ? rowData[col.field] = '' : rowData[col.field]"
                                                    [style]="{'width':'100%'}"></p-dropdown>-->
                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idTipoDelito'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idTipoDelito"
                                                >
                                                <option value="" selected>Seleccione</option>
                                                <option *ngFor="let tipo of listaTipoDelito"
                                                   [value]="tipo.idParametro">{{ tipo.nombreParametro  }}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idEficaciaControl'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idEficaciaControl"
                                                >
                                                <option value="" selected>Seleccione</option>
                                                <option *ngFor="let tipo of listaEficaciaControlesActuales"
                                                   [value]="tipo.idParametro">{{ tipo.nombreParametro  }}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idDebidaDilig'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idDebidaDilig"
                                                >
                                                <option value="" selected>Seleccione</option>
                                                <option *ngFor="let indicador of listaIndicadorDebDiligencia"
                                                   [value]="indicador.idParametro">{{ indicador.nombreParametro  }}</option>>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'indFinPlanAccion'" [(ngModel)]="rowData[col.field]"  class="form-select" id="indFinPlanAccion"
                                                >
                                                <option value="" selected>Seleccione</option>
                                                <option *ngFor="let indicador of listaIndicadorFinPlanAccion"
                                                   [value]="indicador.idParametro">{{ indicador.nombreParametro  }}</option>>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idGerencia'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idGerencia"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let gerencia of listaGerencias"
                                                    [value]="gerencia.idGerencia">{{ gerencia.descripcionGerencia}}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idRespEstrategia'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idRespEstrategia"
                                                 >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let estrategia of listaEstrategiaRespuesta"
                                                  [value]="estrategia.idParametro">{{ estrategia.nombreParametro  }}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idProceso'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idProceso"
                                                (change)="onChangeProceso($event,ri)">
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let proceso of matricesRiesgo[ri].listaProcesos"
                                                    [value]="proceso.idProceso">{{ proceso.deProceso}}</option>
                                        </select>
                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idSubProceso'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idSubProceso"
                                                (change)="onChangeSubProceso($event)">
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let subproceso of matricesRiesgo[ri].listaSubProcesos"
                                                    [value]="subproceso.idSubProceso">{{ subproceso.deSubProceso}}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idOrigenRiesgo'" [(ngModel)]="rowData[col.field]"   class="form-select" id="idOrigenRiesgo"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let origen of listaOrigenRiesgo"
                                              [value]="origen.idParametro">{{ origen.nombreParametro  }}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idFrecuenciaRiesgo'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idFrecuenciaRiesgo"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let frecuencia of listaFrecuenciaRiesgo"
                                              [value]="frecuencia.idParametro">{{ frecuencia.nombreParametro  }}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idTipoRiesgo'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idTipoRiesgo"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let tipo of listaTipoRiesgo"
                                              [value]="tipo.idParametro">{{ tipo.nombreParametro  }}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idFrecuenciaControl'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idFrecuenciaControl"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let tipo of listaFrecuenciaControl"
                                              [value]="tipo.idParametro">{{ tipo.nombreParametro  }}</option>
                                        </select>


                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idOportunidadControl'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idOportunidadControl"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let tipo of listaOportunidadControl"
                                              [value]="tipo.idParametro">{{ tipo.nombreParametro  }}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idAutomatizacionControl'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idAutomatizacionControl"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let tipo of listaAutomatizacionControl"
                                              [value]="tipo.idParametro">{{ tipo.nombreParametro  }}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'idEstadoPlanAccion'" [(ngModel)]="rowData[col.field]"  class="form-select" id="idEstadoPlanAccion"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let estado of listaidEstadoPlanAccion"
                                                    [value]="estado.idParametro">{{ estado.nombreParametro}}</option>
                                        </select>

                                        <select [attr.disabled]="ver ? '' : null || idPerfil==tipoPerfilUsuario ? '' : null" *ngIf="col.field == 'inFicaz'" [(ngModel)]="rowData[col.field]"  class="form-select" id="fueEficaz"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let estado of listaEficazPlanAccion"
                                                    [value]="estado.deValor1">{{ estado.nombreParametro}}</option>
                                        </select>

                                    </ng-template>
                                    <ng-template *ngIf="col.field != 'idGerencia' && col.field != 'idProceso' && col.field != 'idRespEstrategia' && col.field != 'inFicaz' && col.field != 'fechainicioPlanAccion'
                                    && col.field != 'idSubProceso' && col.field != 'idOrigenRiesgo'  && col.field != 'deSeveridadInherente' && col.field != 'deSeveridadResidual' && col.field != 'idEstadoPlanAccion' && col.field != 'idTipoDelito' && col.field != 'idDebidaDilig'  && col.field != 'indFinPlanAccion'
                                    && col.field != 'idFrecuenciaRiesgo' && col.field != 'idTipoRiesgo' && col.field != 'feFinPlanAccion' && col.field != 'fechaPrevista' && col.field != 'fechaVerificacion'
                                     && col.field != 'idFrecuenciaControl' && col.field != 'idOportunidadControl' && col.field != 'idEficaciaControl'"  pTemplate="output">
                                        <!--{{rowData[col.field]}}-->

                                        {{rowData[col.field]}}



                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'fechaInicioPlanAccion'" pTemplate="output">

                                        <input pInputText  *ngIf="col.field == 'fechaInicioPlanAccion'"  class="form-select-hide" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" [(ngModel)]="rowData[col.field]" type="date">

                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'feFinPlanAccion'" pTemplate="output">

                                        <input pInputText  *ngIf="col.field == 'feFinPlanAccion'"  class="form-select-hide" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" [(ngModel)]="rowData[col.field]" type="date">

                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'fechaPrevista'" pTemplate="output">

                                        <input pInputText  *ngIf="col.field == 'fechaPrevista'"  class="form-select-hide" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" [(ngModel)]="rowData[col.field]" type="date">

                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'fechaVerificacion'" pTemplate="output">

                                        <input pInputText  *ngIf="col.field == 'fechaVerificacion'"  class="form-select-hide" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" [(ngModel)]="rowData[col.field]" type="date">

                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idGerencia'" pTemplate="output">
                                        <select *ngIf="col.field == 'idGerencia'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idGerencia"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let gerencia of listaGerencias"
                                                    [value]="gerencia.idGerencia">{{ gerencia.descripcionGerencia}}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idResponsableControl'" pTemplate="output">
                                        <select *ngIf="col.field == 'idResponsableControl'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idResponsableControl"
                                                (change)="onChangeResponsable($event)">
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let area of listaAreaResponsable"
                                                   [value]="area.idParametro">{{ area.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idEstadoPlanAccion'" pTemplate="output">
                                        <select *ngIf="col.field == 'idEstadoPlanAccion'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="estadoPlanAccion"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let estado of listaidEstadoPlanAccion"
                                                    [value]="estado.idParametro">{{ estado.nombreParametro}}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idAreaControl'" pTemplate="output">
                                        <select *ngIf="col.field == 'idAreaControl'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;"  class="form-select" id="idAreaControl"
                                                (change)="onChangeArea($event)">
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let area of listaAreaResponsable"
                                                   [value]="area.idParametro">{{ area.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'inFicaz'" pTemplate="output">
                                        <select *ngIf="col.field == 'inFicaz'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="fueEficaz"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let estado of listaEficazPlanAccion"
                                                    [value]="estado.deValor1">{{ estado.nombreParametro}}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idRespEstrategia'" pTemplate="output">
                                        <select *ngIf="col.field == 'idRespEstrategia'" [(ngModel)]="rowData[col.field]" disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idRespEstrategia"
                                                 >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let estrategia of listaEstrategiaRespuesta"
                                                  [value]="estrategia.idParametro">{{ estrategia.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idEficaciaControl'" pTemplate="output">
                                        <select *ngIf="col.field == 'idEficaciaControl'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idEficaciaControl"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let eficacia of listaEficaciaControlesActuales"
                                                   [value]="eficacia.idParametro">{{ eficacia.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'dePuntaInhe'" pTemplate="output">

                                        <div *ngIf="rowData[col.field]=='Bajo'">
                                            <div class="circle-green">{{rowData[col.field]}}</div>
                                        </div>

                                        <div *ngIf="rowData[col.field]=='Moderado'">
                                            <div class="circle-yellow">{{rowData[col.field]}}</div>
                                        </div>

                                        <div *ngIf="rowData[col.field]=='Alto'">
                                            <div class="circle-orange">{{rowData[col.field]}}</div>
                                        </div>

                                        <div *ngIf="rowData[col.field]=='Extremo'">
                                            <div class="circle-red">{{rowData[col.field]}}</div>
                                        </div>

                                    </ng-template>


                                    <ng-template *ngIf="col.field == 'deSeveridadRes'" pTemplate="output">

                                        <div *ngIf="rowData[col.field]=='Bajo'">
                                            <div class="circle-green">{{rowData[col.field]}}</div>
                                        </div>

                                        <div *ngIf="rowData[col.field]=='Moderado'">
                                            <div class="circle-yellow">{{rowData[col.field]}}</div>
                                        </div>

                                        <div *ngIf="rowData[col.field]=='Alto'">
                                            <div class="circle-orange">{{rowData[col.field]}}</div>
                                        </div>

                                        <div *ngIf="rowData[col.field]=='Extremo'">
                                            <div class="circle-red">{{rowData[col.field]}}</div>
                                        </div>

                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idProceso'" pTemplate="output">
                                        <select *ngIf="col.field == 'idProceso'" [(ngModel)]="rowData[col.field]"   disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idProceso"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let proceso of matricesRiesgo[ri].listaProcesos"
                                                    [value]="proceso.idProceso">{{ proceso.deProceso}}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idSubProceso'" pTemplate="output">
                                        <select *ngIf="col.field == 'idSubProceso'" [(ngModel)]="rowData[col.field]"   disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idSubProceso"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let subproceso of matricesRiesgo[ri].listaSubProcesos"
                                                    [value]="subproceso.idSubProceso">{{ subproceso.deSubProceso}}</option>
                                        </select>
                                    </ng-template>


                                    <ng-template *ngIf="col.field == 'idOrigenRiesgo'" pTemplate="output">
                                        <select *ngIf="col.field == 'idOrigenRiesgo'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idOrigenRiesgo"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let origen of listaOrigenRiesgo"
                                              [value]="origen.idParametro">{{ origen.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>


                                    <ng-template *ngIf="col.field == 'idFrecuenciaRiesgo'" pTemplate="output">
                                        <select *ngIf="col.field == 'idFrecuenciaRiesgo'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idFrecuenciaRiesgo"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let frecuencia of listaFrecuenciaRiesgo"
                                              [value]="frecuencia.idParametro">{{ frecuencia.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idTipoRiesgo'" pTemplate="output">
                                        <select *ngIf="col.field == 'idTipoRiesgo'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idTipoRiesgo"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let tipo of listaTipoRiesgo"
                                              [value]="tipo.idParametro">{{ tipo.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idFrecuenciaControl'" pTemplate="output">
                                        <select *ngIf="col.field == 'idFrecuenciaControl'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idFrecuenciaControl"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let frecuencia of listaFrecuenciaControl"
                                              [value]="frecuencia.idParametro">{{ frecuencia.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idOportunidadControl'" pTemplate="output">
                                        <select *ngIf="col.field == 'idOportunidadControl'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idOportunidadControl"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let oportunidad of listaOportunidadControl"
                                              [value]="oportunidad.idParametro">{{ oportunidad.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idTipoDelito'" pTemplate="output">
                                        <select *ngIf="col.field == 'idTipoDelito'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;"  class="form-select" id="idTipoDelito"
                                        >
                                           <option value="" selected>Seleccione</option>
                                           <option *ngFor="let tipo of listaTipoDelito"
                                           [value]="tipo.idParametro">{{ tipo.nombreParametro  }}</option>>
                                        </select>
                                    </ng-template>


                                    <ng-template *ngIf="col.field == 'idDebidaDilig'" pTemplate="output">
                                        <select *ngIf="col.field == 'idDebidaDilig'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;"  class="form-select" id="idDebidaDilig"
                                        >
                                        <option value="" selected>Seleccione</option>
                                        <option *ngFor="let indicador of listaIndicadorDebDiligencia"
                                           [value]="indicador.idParametro">{{ indicador.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'indFinPlanAccion'" pTemplate="output">
                                        <select *ngIf="col.field == 'indFinPlanAccion'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;"  class="form-select" id="indFinPlanAccion"
                                        >
                                        <option value="" selected>Seleccione</option>
                                        <option *ngFor="let indicador of listaIndicadorFinPlanAccion"
                                           [value]="indicador.idParametro">{{ indicador.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>

                                    <ng-template *ngIf="col.field == 'idAutomatizacionControl'" pTemplate="output">
                                        <select *ngIf="col.field == 'idAutomatizacionControl'" [(ngModel)]="rowData[col.field]"  disabled class="form-select-hide form-select" style="border: 0px solid #ced4da;border-radius: .25rem;background-image:url();background-color: white;" id="idAutomatizacionControl"
                                                >
                                            <option value="" selected>Seleccione</option>
                                            <option *ngFor="let automatizacion of listaAutomatizacionControl"
                                              [value]="automatizacion.idParametro">{{ automatizacion.nombreParametro  }}</option>
                                        </select>
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td style="text-align:center;" class="tdsmall">
                                <!-- <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow
                                        icon="pi pi-pencil" (click)="editarRegistro(rowData, ri)"
                                        class="p-button-rounded p-button-text"></button> -->
                                <button *ngIf="(matrizRiesgo != null && editar == true && idPerfil!=tipoPerfilUsuario) || matrizRiesgo == null" pButton pRipple type="button" icon="pi pi-plus"
                                        (click)="replicarMatrices(rowData, ri)"
                                        class="p-button-rounded p-button-text"></button>

                                <button *ngIf="(matrizRiesgo != null && editar == true && idPerfil!=tipoPerfilUsuario) || matrizRiesgo == null" pButton pRipple type="button"
                                        icon="pi pi-trash" (click)="borrarRegistro(rowData, ri)"
                                        class="p-button-rounded p-button-text"></button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>

            <div>
                <div class="row justify-content-between d-flex">
                    <div class="col">
                        <div class="container matriz-amplitud card-body">
                            <!-- <button pButton pRipple type="button"
                                    label="Riesgo Inherente"
                                    class="p-button-raised p-button-warning"
                                    (click)="openDiagramRiesgoInherente()">
                            </button>
                            <button pButton pRipple type="button"
                                    label="Riesgo Residual"
                                    class="p-button-raised p-button-warning"
                                    (click)="openDiagramRiesgoResidual()">
                            </button> -->
                        </div>
                    </div>

                    <div class="col">
                        <div class="container matriz-amplitud card-body p-text-right" style="margin-left: -15px;">
                            <button type="submit" class="btn btn-primary" form="formMatriz" style="margin-right: 10px;"
                                    *ngIf="matrizRiesgo == null">Crear
                            </button>
                            <button type="submit" class="btn btn-primary" form="formMatriz" style="margin-right: 10px;"
                                    *ngIf="matrizRiesgo != null && editar == true">Actualizar
                            </button>
                            <button type="button" class="btn btn-danger" [routerLink]="['..']"
                                    *ngIf="matrizRiesgo == null">
                                Cancelar
                            </button>
                            <button type="button" class="btn btn-danger"
                                    [routerLink]="['/pages','main','transaccion','matrizAnticorrupcion']"
                                    *ngIf="matrizRiesgo != null">Cancelar
                            </button>
                        </div>
                    </div>


                </div>
            </div>


        </fieldset>

            <br>

            <!-- Tabla de matriz de riesgo-->

        </div>


        <!--Skeleton -->
        <div class="container matriz-amplitud sombraCards espacioBody" *ngIf="loading">
            <h3 class="animated fadeIn fast mt-4" style="margin-bottom: -10px;">
                <p-skeleton height="2rem" styleClass="p-mb-2"></p-skeleton>
            </h3>

            <br>
            <hr>
            <form [formGroup]="formularioMatrizRiesgo"
                  (ngSubmit)=" matrizRiesgo == null ? registrarMatrizRiesgo() : actualizarMatrizRiesgo()">
                <br>

                <fieldset class="border p-2 animated fadeIn">
                    <p-skeleton height="2rem" styleClass="p-mb-2"></p-skeleton>
                    <br><br>
                    <div class="container">
                        <div class="row">

                            <div class="form-group col-sm-12 mb-4">
                                <p-skeleton height="3rem" styleClass="p-mb-2"></p-skeleton>
                            </div>
                            <div class="form-group col-sm-12 mb-4">
                                <p-skeleton height="3rem" styleClass="p-mb-2"></p-skeleton>
                            </div>
                            <div class="container card-body p-text-right">
                                <p-skeleton height="3rem" styleClass="p-mb-2"></p-skeleton>
                            </div>
                        </div>
                        <br>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
</div>
